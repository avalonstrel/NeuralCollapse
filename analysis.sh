
expr_prefix="conv_fc_comparison"
# config_names=cifar10_32_100_hybrid_conv_256s16k3l12
# config_names="cifar10_32_100_hybrid_conv_128down2k3l12 cifar10_32_100_hybrid_conv_128down4k3l9 cifar10_32_100_hybrid_conv_128s16k3l12 cifar10_32_100_hybrid_conv_128s16k7l12 cifar10_32_100_hybrid_conv_512down2k3l12"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_512down4k3l9 cifar10_32_100_hybrid_conv_512s4k1l12 cifar10_32_100_hybrid_conv_512s4k3l12"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_up256down2k3l12 cifar10_32_100_hybrid_conv_up256down4k3l9 cifar10_32_100_hybrid_conv_up512down2k3l12"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_up512down2k3l15_m256 cifar10_32_100_hybrid_conv_up512down2k3l15_m512 cifar10_32_100_hybrid_conv_up512down2k3l18_m256_m512 cifar10_32_100_hybrid_conv_up512down4k3l9"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_256s16k3l12 cifar10_32_100_hybrid_conv_256s16k7l12 cifar10_32_100_hybrid_conv_512s4k1l9 cifar10_32_100_hybrid_conv_512s4k1l15"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_512s4k3l9 cifar10_32_100_hybrid_conv_512s4k3l15 cifar10_32_100_hybrid_conv_512s8k3l12 cifar10_32_100_hybrid_conv_512s16k3l12 cifar10_32_100_hybrid_conv_512s16k7l12"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_512s16k7l12 cifar10_32_100_hybrid_conv_up1024down2k3l12 cifar10_32_100_hybrid_conv_up1024down4k3l9 cifar10_32_100_hybrid_conv_512down2k3l24 cifar10_32_100_hybrid_conv_512down4k3l18 cifar10_32_100_hybrid_conv_512down8k3l6 cifar10_32_100_hybrid_conv_512down8k3l12"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_128down2k3l24 cifar10_32_100_hybrid_conv_128down4k3l18 cifar10_32_100_hybrid_conv_128down8k3l6 cifar10_32_100_hybrid_conv_128down8k3l12"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_512down2k3l18_3663 cifar10_32_100_hybrid_conv_512down2k3l18_6336 cifar10_32_100_hybrid_conv_512down2k3l18_6363 cifar10_32_100_hybrid_conv_512down2k3l18_6633"
# config_names=${config_names}" cifar10_32_100_hybrid_conv_fc_up128down4k3l9lf6_fc2048 cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf3_fc2048 cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf6_fc2048 cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf9_fc2048 cifar10_32_100_hybrid_conv_fc_up2048down4k3l9lf6_fc2048"

# config_names="cifar10_32_100_hybrid_fc_l6_fc2048 cifar10_32_100_hybrid_fc_l9_fc2048 cifar10_32_100_hybrid_fc_l12_fc2048 cifar10_32_100_hybrid_fc_l15_fc2048"
# config_names=${config_names}" cifar10_32_100_hybrid_fc_l6_fc2048_bn cifar10_32_100_hybrid_fc_l9_fc2048_bn cifar10_32_100_hybrid_fc_l12_fc2048_bn"

config_names="cifar10_32_100_hybrid_conv_fc_up128down4k3l9lf3_fc2048 cifar10_32_100_hybrid_conv_fc_up128down4k3l9lf3_fc2048_bn cifar10_32_100_hybrid_conv_fc_up128down4k3l9lf6_fc2048 cifar10_32_100_hybrid_conv_fc_up128down4k3l9lf6_fc2048_bn"
config_names=${config_names}" cifar10_32_100_hybrid_conv_fc_up128down4k3l9lf9_fc2048 cifar10_32_100_hybrid_conv_fc_up128down4k3l9lf9_fc2048_bn cifar10_32_100_hybrid_conv_fc_up256down4k3l9lf6_fc1024 cifar10_32_100_hybrid_conv_fc_up256down4k3l9lf6_fc1024_bn"
config_names=${config_names}" cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf3_fc2048 cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf3_fc2048_bn cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf6_fc2048 cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf6_fc2048_bn"
config_names=${config_names}" cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf9_fc2048 cifar10_32_100_hybrid_conv_fc_up512down4k3l9lf9_fc2048_bn cifar10_32_100_hybrid_conv_fc_up2048down4k3l9lf6_fc2048 cifar10_32_100_hybrid_conv_fc_up2048down4k3l9lf6_fc2048_bn"
config_names=${config_names}" cifar10_32_100_hybrid_conv_512down2k3l18_6CC6 cifar10_32_100_hybrid_conv_512down2k3l18_C6C6 cifar10_32_100_hybrid_conv_512down2k3l18_C66C cifar10_32_100_hybrid_conv_512down2k3l18_CC66"

config_names=${config_names}" cifar10_32_100_hybrid_conv_128s8k1l12 cifar10_32_100_hybrid_conv_128s8k3l12 cifar10_32_100_hybrid_conv_128s8k5l12 cifar10_32_100_hybrid_conv_128s8k7l12"
config_names=${config_names}" cifar10_32_100_hybrid_conv_128s16k1l12 cifar10_32_100_hybrid_conv_128s16k3l12 cifar10_32_100_hybrid_conv_128s16k5l12 cifar10_32_100_hybrid_conv_128s16k7l12"
config_names=${config_names}" cifar10_32_100_hybrid_conv_1024s16k3l12"
# # seeds="97 177 197 223 337 463 759 777 919 7 99 103"
seeds="97 177 197"

gpu_num=2
max_num=36
curr_num=0
fig_names=""
tag="new-block-in-down-rand"
for seed in $seeds
do
    for config_name in $config_names    
    do
        date=$seed
        
        gpu_id=$(($curr_num % $gpu_num))
        FINAL_FILE=./exprs/$expr_prefix/$config_name/$seed/chckpoints/iter_4000.pth
        FIG_FILE=./figures/$expr_prefix/${config_name}/$tag/${seed}_${tag}.png
        # echo $FINAL_FILE
        # echo $FIG_FILE

        if [ -f "$FINAL_FILE" ] && [ ! -f "$FIG_FILE" ];
        then
            echo $seed
            echo $config_name
            python3 analysis.py --model_names $config_name \
                                --gpu_id $gpu_id \
                                --seeds $seed \
                                --feat_types $tag \
                                --expr_prefix $expr_prefix &
        
            curr_num=$(($curr_num + 1))
            fig_names=${fig_names}" "${config_name}/$tag/${seed}_${tag}.png
        fi
        if [[ ${curr_num} -ge ${max_num} ]]
        then
            finished_num=0
            while [[ ${finished_num} == 0 ]]
            do
                sleep 300
                finished_num=0
                tmp_fig_names=""
                for fig_name in $fig_names
                do
                    FILE=./figures/$expr_prefix/$fig_name
                    if [[ -f "$FILE" ]]
                    then
                        finished_num=$(($finished_num + 1))
                        echo "Finshed: "$FILE
                    else
                        tmp_fig_names=${tmp_fig_names}" "${fig_name}
                    fi 
                done
            done
            fig_names=${tmp_fig_names}
            curr_num=$(($curr_num - $finished_num))
        fi
    done
done

finished_num=0
while [[ ${finished_num} != ${curr_num} ]]
do
    sleep 1200
    finished_num=0
    for fig_name in $fig_names
    do
        FILE=./figures/$expr_prefix/$fig_name
        if [[ -f "$FILE" ]]
        then
            finished_num=$(($finished_num + 1))
            echo "Finshed: "$FILE
        fi 
    done
done

echo "Finished."
